<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Ballerina by Example: JMS Message Headers</title>
    <!--GA-->
      <script>
         (function (i, s, o, g, r, a, m) {
             i['GoogleAnalyticsObject'] = r;
             i[r] = i[r] || function () {
                 (i[r].q = i[r].q || []).push(arguments)
             }, i[r].l = 1 * new Date();
             a = s.createElement(o),
                     m = s.getElementsByTagName(o)[0];
             a.async = 1;
             a.src = g;
             m.parentNode.insertBefore(a, m)
         })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');
         
         ga('create', 'UA-92163714-1', 'auto');
         ga('send', 'pageview');
         
      </script>
      <!-- Google Tag Manager -->
      <script>(function (w, d, s, l, i) {
         w[l] = w[l] || [];
         w[l].push({'gtm.start':
                     new Date().getTime(), event: 'gtm.js'});
         var f = d.getElementsByTagName(s)[0],
                 j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : '';
         j.async = true;
         j.src =
                 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
         f.parentNode.insertBefore(j, f);
         })(window, document, 'script', 'dataLayer', 'GTM-KW2LLTW');
      </script>
      <!-- End Google Tag Manager -->
      <!-- Hotjar Tracking Code for https://ballerinalang.org/ --> 
      <script>
         (function (h, o, t, j, a, r) {
             h.hj = h.hj || function () {
                 (h.hj.q = h.hj.q || []).push(arguments)
             };
             h._hjSettings = {hjid: 442732, hjsv: 5};
             a = o.getElementsByTagName('head')[0];
             r = o.createElement('script');
             r.async = 1;
             r.src = t + h._hjSettings.hjid + j + h._hjSettings.hjsv;
             a.appendChild(r);
         })(window, document, '//static.hotjar.com/c/hotjar-', '.js?sv=');
      </script>
    
     <link href="https://b.content.wso2.com/sites/all/bootstrap/css/bootstrap.css?230617" rel="stylesheet">
      <script src="https://b.content.wso2.com/sites/all/bootstrap/js/jquery.js?230617"></script>
      <script src="https://b.content.wso2.com/sites/all/bootstrap/js/bootstrap.js?230617"></script>
      
      <script src="http://b.content.wso2.com/sites/all/ballerina/ballerina-example.js"></script>
<script  defer="defer" src="https://wso2.cachefly.net/wso2/sites/all/ballerina/js/ballerina.js"></script>
<!--      <link rel=stylesheet href="https://ballerinalang.org/css/ballerina.css?230617">-->
    <link rel=stylesheet href="site.css">
    <link href="https://fonts.googleapis.com/css?family=Cairo:200,300,400,600,700,900" rel="stylesheet">
    <link rel=stylesheet href="http://b.content.wso2.com/sites/all/ballerina/ballerina-example.css">
    
    
  </head>
  <body>
        <div class="row cBallerinaNav" id="iBallerinaNavigation">

        </div>
      <div class="row cBallerinaBySampleRow">
          <div class="container cBallerinaBySampleContainer">
              <div class="example" id="jms-message-headers">
                  <div class="col-xs-11 col-sm-11 col-md-11">
                      <h2><a href="./">Ballerina by Example</a>: JMS Message Headers</h2>
                  </div>
                  <div class="col-xs-1 col-sm-1 col-md-1">
                      <a href="./" class="cBackButton"><img src="http://b.content.wso2.com/sites/all/ballerina/backbutton.svg"/></a>
                  </div>
                  <div class="col-xs-12 col-sm-12 col-md-12">

                      

                      <table>
                          
                          <tr>
                              <td class="docs">
                                  <p>In this example we show how you can set and get JMS message headers for a Ballerina program.
 Note that non JMS message headers will get ignored when you send the message to a JMS provider.</p>

                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre><span class="kn">import</span> <span class="nx">ballerina</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">messages</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="p">.</span><span class="nx">lang</span><span class="p">.</span><span class="nx">system</span><span class="p">;</span>
<span class="kn">import</span> <span class="nx">ballerina</span><span class="p">.</span><span class="nx">net</span><span class="p">.</span><span class="nx">jms</span><span class="p">;</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  
                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre><span class="nd">@jms:config {</span>
    <span class="nx">initialContextFactory</span><span class="p">:</span><span class="s">&quot;wso2mbInitialContextFactory&quot;</span><span class="p">,</span>
    <span class="nx">providerUrl</span><span class="p">:</span>
           <span class="s">&quot;amqp://admin:admin@carbon/carbon?brokerlist=&#39;tcp://localhost:5672&#39;&quot;</span><span class="p">,</span>
    <span class="nx">connectionFactoryType</span><span class="p">:</span><span class="s">&quot;queue&quot;</span><span class="p">,</span>
    <span class="nx">connectionFactoryName</span><span class="p">:</span><span class="s">&quot;QueueConnectionFactory&quot;</span><span class="p">,</span>
    <span class="nx">destination</span><span class="p">:</span><span class="s">&quot;MyQueue&quot;</span><span class="p">,</span>
    <span class="nx">acknowledgmentMode</span><span class="p">:</span><span class="s">&quot;AUTO_ACKNOWLEDGE&quot;</span>
<span class="p">}</span>
<span class="kd">service</span><span class="p">&lt;</span><span class="nx">jms</span><span class="p">&gt;</span> <span class="nx">jmsService</span> <span class="p">{</span>
    <span class="kd">resource</span> <span class="nx">onMessage</span> <span class="p">(</span><span class="kt">message</span> <span class="nx">m</span><span class="p">)</span> <span class="p">{</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  <p>Read all the supported headers from the message.</p>

                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre>        <span class="kt">string</span> <span class="nx">correlationId</span> <span class="p">=</span> <span class="nx">messages</span><span class="p">:</span><span class="nx">getHeader</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_CORRELATION_ID</span><span class="p">);</span>
        <span class="kt">string</span> <span class="nx">timestamp</span> <span class="p">=</span> <span class="nx">messages</span><span class="p">:</span><span class="nx">getHeader</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_TIMESTAMP</span><span class="p">);</span>
        <span class="kt">string</span> <span class="nx">messageType</span> <span class="p">=</span> <span class="nx">messages</span><span class="p">:</span><span class="nx">getHeader</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_MESSAGE_TYPE</span><span class="p">);</span>
        <span class="kt">string</span> <span class="nx">messageId</span> <span class="p">=</span> <span class="nx">messages</span><span class="p">:</span><span class="nx">getHeader</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_MESSAGE_ID</span><span class="p">);</span>
        <span class="kt">string</span> <span class="nx">destination</span> <span class="p">=</span> <span class="nx">messages</span><span class="p">:</span><span class="nx">getHeader</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_DESTINATION</span><span class="p">);</span>
        <span class="kt">string</span> <span class="nx">redelivered</span> <span class="p">=</span> <span class="nx">messages</span><span class="p">:</span><span class="nx">getHeader</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_REDELIVERED</span><span class="p">);</span>
        <span class="kt">string</span> <span class="nx">expirationTime</span> <span class="p">=</span> <span class="nx">messages</span><span class="p">:</span><span class="nx">getHeader</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_EXPIRATION</span><span class="p">);</span>
        <span class="kt">string</span> <span class="nx">priority</span> <span class="p">=</span> <span class="nx">messages</span><span class="p">:</span><span class="nx">getHeader</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_PRIORITY</span><span class="p">);</span>
        <span class="kt">string</span> <span class="nx">deliveryMode</span> <span class="p">=</span> <span class="nx">messages</span><span class="p">:</span><span class="nx">getHeader</span><span class="p">(</span><span class="nx">m</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_DELIVERY_MODE</span><span class="p">);</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  <p>For delivery mode we can use the built in constant as follows to infer whether the message is a persistent message or not.</p>

                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre>        <span class="k">if</span> <span class="p">(</span><span class="nx">deliveryMode</span> <span class="o">==</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">PERSISTENT_DELIVERY_MODE</span><span class="p">)</span> <span class="p">{</span>
            <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;delivery mode: persistent&quot;</span><span class="p">);</span>
        <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">deliveryMode</span> <span class="o">==</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">PERSISTENT_DELIVERY_MODE</span><span class="p">){</span>
            <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;delivery mode: non-persistent&quot;</span><span class="p">);</span>
        <span class="p">}</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  <p>Print the header values.</p>

                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre>        <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;correlationId: &quot;</span> <span class="o">+</span> <span class="nx">correlationId</span><span class="p">);</span>
        <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;timestamp: &quot;</span> <span class="o">+</span> <span class="nx">timestamp</span><span class="p">);</span>
        <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;message type : &quot;</span> <span class="o">+</span> <span class="nx">messageType</span><span class="p">);</span>
        <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;message id : &quot;</span> <span class="o">+</span> <span class="nx">messageId</span><span class="p">);</span>
        <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;destination : &quot;</span> <span class="o">+</span> <span class="nx">destination</span><span class="p">);</span>
        <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;is redelivered : &quot;</span> <span class="o">+</span> <span class="nx">redelivered</span><span class="p">);</span>
        <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;expiration time : &quot;</span> <span class="o">+</span> <span class="nx">expirationTime</span><span class="p">);</span>
        <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;priority : &quot;</span> <span class="o">+</span> <span class="nx">priority</span><span class="p">);</span>
        <span class="nx">system</span><span class="p">:</span><span class="nb">println</span><span class="p">(</span><span class="s">&quot;----------------------------------&quot;</span><span class="p">);</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  
                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre>        <span class="kt">message</span> <span class="nx">responseMessage</span> <span class="p">=</span> <span class="p">{};</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  <p>ReplyTo header is set with the name of the queue. You can retrieve this value when receiving a message using the getHeader function as well.</p>

                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre>        <span class="nx">messages</span><span class="p">:</span><span class="nx">setHeader</span><span class="p">(</span><span class="nx">responseMessage</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_REPLY_TO</span><span class="p">,</span> <span class="s">&quot;ResponseQueue&quot;</span><span class="p">);</span>
        <span class="nx">messages</span><span class="p">:</span><span class="nx">setHeader</span><span class="p">(</span><span class="nx">responseMessage</span><span class="p">,</span> 
                           <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_CORRELATION_ID</span><span class="p">,</span> <span class="s">&quot;response-001&quot;</span><span class="p">);</span>
        <span class="nx">messages</span><span class="p">:</span><span class="nx">setHeader</span><span class="p">(</span><span class="nx">responseMessage</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_PRIORITY</span><span class="p">,</span> <span class="s">&quot;8&quot;</span><span class="p">);</span>
        <span class="nx">messages</span><span class="p">:</span><span class="nx">setHeader</span><span class="p">(</span><span class="nx">responseMessage</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_DELIVERY_MODE</span><span class="p">,</span> 
                                            <span class="nx">jms</span><span class="p">:</span><span class="nx">NON_PERSISTENT_DELIVERY_MODE</span><span class="p">);</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  <p>We can explicitly set the message type. If we use functions like setStringPayload,
 setJSONPayload and setXMLPayload content type will be set.
 And when we send the message the content type will be used as the message type value.
 Therefore we might not need to explicitly set this value.</p>

                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre>        <span class="nx">messages</span><span class="p">:</span><span class="nx">setHeader</span><span class="p">(</span><span class="nx">responseMessage</span><span class="p">,</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">HDR_MESSAGE_TYPE</span><span class="p">,</span> 
                                            <span class="s">&quot;application/json&quot;</span><span class="p">);</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  
                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre>        <span class="kt">map</span> <span class="nx">properties</span> <span class="p">=</span> <span class="p">{</span>   
                         <span class="s">&quot;initialContextFactory&quot;</span><span class="p">:</span><span class="s">&quot;wso2mbInitialContextFactory&quot;</span><span class="p">,</span>
                         <span class="s">&quot;configFilePath&quot;</span><span class="p">:</span><span class="s">&quot;../jndi.properties&quot;</span><span class="p">,</span>
                         <span class="s">&quot;connectionFactoryName&quot;</span><span class="p">:</span> <span class="s">&quot;QueueConnectionFactory&quot;</span><span class="p">,</span>
                         <span class="s">&quot;connectionFactoryType&quot;</span> <span class="p">:</span> <span class="s">&quot;queue&quot;</span><span class="p">};</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  
                              </td>
                              <td class="code leading">
                                  
                                  <div class="highlight"><pre>        <span class="nx">jms</span><span class="p">:</span><span class="nx">ClientConnector</span> <span class="nx">jmsEP</span> <span class="p">=</span> <span class="nx">create</span> <span class="nx">jms</span><span class="p">:</span><span class="nx">ClientConnector</span><span class="p">(</span><span class="nx">properties</span><span class="p">);</span>
        <span class="nx">jms</span><span class="p">:</span><span class="nx">ClientConnector</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">jmsEP</span><span class="p">,</span> <span class="s">&quot;MySecondQueue&quot;</span><span class="p">,</span> <span class="nx">responseMessage</span><span class="p">);</span>
</pre></div>

                              </td>
                          </tr>
                          
                          <tr>
                              <td class="docs">
                                  
                              </td>
                              <td class="code">
                                  
                                  <div class="highlight"><pre>    <span class="p">}</span>
<span class="p">}</span>
</pre></div>

                              </td>
                          </tr>
                          
                      </table>


                      

                      <table>
                          
                          <tr>
                              <td class="docs">
                                  <p>To run the program, put the code in <code>jms-message-headers.bal</code>
 and use <code>$BALLERINA_HOME/bin/ballerina</code>.</p>

                              </td>
                              <td class="code">
                                  
                                  <div class="highlight"><pre><span class="gp">$</span> ballerina run service jms-message-headers.bal
</pre></div>

                              </td>
                          </tr>
                          
                      </table>


                      
                      
                      <p class="next">
                          Next example: <a href="jms-message-producer">JMS Message Producer</a>.
                      </p>
                      

                  </div>
                  <div class="col-xs-12 col-sm-12 col-md-12 cGOfooter">
                      <p class="footer">
                          by <a href="https://twitter.com/ballerinalang">@ballerinalang</a> | <a href="mailto:ballerina-dev@googlegroups.com">feedback</a> | <a href="https://github.com/ballerinalang/ballerina/tree/ballerina-by-example-src/samples/ballerina-by-example/examples/jms-message-headers">source</a>
                      </p>
                      <p class="attrib">
                          This site was generated using a <a href="https://github.com/mmcgrana/gobyexample/">tool</a> developed by <a href="https://twitter.com/mmcgrana">@mmcgrana</a>, licensed under <a href="https://creativecommons.org/licenses/by/2.0/">CC BY</a> / modified from original
                      </p>
                  </div>
              </div>
              
          </div>
      </div>
      <div class="row cBallerinaFooter" id="iBallerinaFooter">
      </div>
      
  </body>
</html>
