<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-92163714-1', 'auto');
  ga('send', 'pageview');

</script>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KW2LLTW');</script>
<!-- End Google Tag Manager -->

  
  
  
  <meta name="author" content="WSO2, Inc.">
  <link rel="shortcut icon" href="../../img/favicon.ico">
  <title>Transactions - Ballerina Documentation</title>
<!--  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>-->

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
   <link rel="stylesheet" href="../../css/ballerina.css">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Transactions";
    var mkdocs_page_input_path = "specification/transactions.md";
    var mkdocs_page_url = "/specification/transactions/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script> 
  
  
  
  
  <!--TOC-->



<!--TOC END-->
  
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="http://ballerinalang.org" class="cBallerinaLogo"><img src="../../img/ballerina-logo.svg"/></a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
<!--            <li><a href="../..">Documentation Home</li>-->
          
            <li>

  <li class="cMainLink"><span>Get Started</span>
    <ul class="subnav">
        
            


    <li class="toctree-l1 ">
        <a class="" href="../..">Welcome</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../quick-tour/">Quick Tour</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../tutorials/first-program/">Write your First Program</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../key-concepts/">Key Concepts</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../tools/">Tools</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../samples/">Samples</a>
        
    </li>


        
    </ul>
      </li>

<li>
          
            <li>

  <li class="cMainLink"><span>Tutorials</span>
    <ul class="subnav">
        
            


    <li class="toctree-l1 ">
        <a class="" href="../../tutorials/">Introduction</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../tutorials/first-program/">Write your First Program</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../tutorials/create-archive/">Create an Archive of your Program</a>
        
    </li>


        
    </ul>
      </li>

<li>
          
            <li>

  <li class="cMainLink"><span>Language Reference</span>
    <ul class="subnav">
        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/lang-overview/">Overview</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/packaging/">Packaging and Running Programs</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/services/">Services</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/resources/">Resources</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/functions/">Functions</a>
        
    </li>


        
            

  <li class="cMainLink"><span>Connectors</span>
    <ul class="subnav">
        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/connectors/">Working with Connectors</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../server-connectors/file-server/">File Server Connector</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../server-connectors/http2-server/">HTTP/2 Server Connector</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../server-connectors/jms-client/">JMS Client Connector</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../server-connectors/jms-server/">JMS Server Connector</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../server-connectors/websocket-server/">WebSocket Server Connector</a>
        
    </li>


        
    </ul>
      </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/actions/">Actions</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/workers/">Workers</a>
        
    </li>


        
            


    <li class="toctree-l1 current">
        <a class="current" href="./">Transactions</a>
        
            <ul>
                <li><a href="../..">Home</a></li>
            
                <li class="toctree-l3"><a href="#transactions">Transactions</a></li>
                
                 <li><a class="toctree-l4" href="#local-transactions">Local Transactions</a></li>
                
                 <li><a class="toctree-l4" href="#distributed-transactions-globalxa-transactions">Distributed Transactions: (Global/XA Transactions)</a></li>
                
                 <li><a class="toctree-l4" href="#example">Example</a></li>
                
            
            </ul>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/types-variables/">Types and Variables</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/statements/">Statements</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../lang-ref/exceptions/">Exception Handling</a>
        
    </li>


        
    </ul>
      </li>

<li>
          
            <li>

  <li class="cMainLink"><span>Additional Reference</span>
    <ul class="subnav">
        
            


    <li class="toctree-l1 ">
        <a class="" href="../../native-functions/">Native Functions (API Documentation)</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../spec/">Language Specification</a>
        
    </li>


        
            


    <li class="toctree-l1 ">
        <a class="" href="../../architecture/">Architecture Design Documents</a>
        
    </li>


        
    </ul>
      </li>

<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Ballerina Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Language Reference &raquo;</li>
        
      
    
    <li>Transactions</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/ballerinalang/ballerina/edit/master/docs/specification/transactions.md"
          class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="transactions">Transactions</h1>
<p>Transaction processing is information processing that is divided into individual, indivisible operations called transactions. Each transaction must succeed or fail as a complete unit; it can never be only partially complete. </p>
<p>A transaction is a series of data manipulation statements that must either fully complete or fully fail, leaving the system in a consistent state. It symbolizes a unit of work performed and treated in a coherent and reliable way independent of other transactions. There are two types of transactions; local and distributed.</p>
<h2 id="local-transactions">Local Transactions</h2>
<p>Local transactions are transactions associated with a particular datasource (this means they are resource-specific). The most common example is a transaction associated with a JDBC connection.</p>
<h2 id="distributed-transactions-globalxa-transactions">Distributed Transactions: (Global/XA Transactions)</h2>
<p>A distributed transaction is a transaction that accesses and updates data on two or more networked resources, and therefore must be coordinated among those resources. This coordination is the function of the transaction manager. The transaction manager is responsible for making the final decision either to commit or rollback any distributed transaction and it uses the two phase commit protocol for that.</p>
<ul>
<li>First phase: The transaction manager polls all of the resource managers involved in the distributed transaction to see if each one is ready to commit. If a resource manager cannot commit, it responds negatively and rolls back its particular part of the transaction so that data is not altered.</li>
<li>Second phase: The transaction manager determines if any of the resource managers have responded negatively, and, if so, rolls back the whole transaction. If there are no negative responses, the translation manager commits the whole transaction, and returns the results to the application.</li>
</ul>
<p>JTA specifies standard Java interfaces between the transaction manager and the other components in a distributed transaction: the application, the application server, and the resource managers. <a href="https://www.atomikos.com/">Atomikos</a> is used as open source JTA implementation.</p>
<p>A <code>transaction</code> is defined as follows:</p>
<pre><code>transaction { 

   sql:ClientConnector.update(testdb1,...) 


   sql:ClientConnector.update(testdb2,...) 

    If ( ...) {
        abort;
    }


   ....
   //commit all local &amp;  XA transactions and close connections
} aborted { 
   //Logic which needs to execute on transaction failure
   ...

   ...
}

</code></pre>

<p>The <code>aborted</code> section is executed after the transaction is rolled back due to any of the following conditions:
- an exception occurred within the transaction block
- abort statement
- throw statement</p>
<h3 id="nested-transactions">Nested Transactions</h3>
<p>A <code>nested transaction</code> is defined as follows:</p>
<pre><code>transaction { 

   ....

   ....

    transaction {

       ....

       ....

    } 
    aborted { 
       ...

       ...
    }
   ....

   ....


} 
aborted { 
   //Logic which needs to execute on transaction failure
   ...

   ...
}
</code></pre>

<p>Ballerina allows you to have transactions within a transaction.  All internal transactions are committed or aborted at the end of the outer most transaction block. If any of the transactions fail, the aborted block gets executed and all the transactions are rollbacked. The transaction is successful if all the nested transactions are successfully committed.</p>
<h2 id="example">Example</h2>
<p>The following is an example of a local transaction where the transaction gets aborted if any of the <code>update</code> actions fail.</p>
<pre><code>    map propertiesMap = {&quot;jdbcUrl&quot;:&quot;jdbc:hsqldb:file:./target/tempdb/TEST_SQL_CONNECTOR&quot;,
                         &quot;username&quot;:&quot;SA&quot;, &quot;password&quot;:&quot;&quot;, &quot;maximumPoolSize&quot;:1};
    sql:ClientConnector testDB = create sql:ClientConnector(propertiesMap);
    sql:Parameter[] parameters = [];
    transaction {
    sql:ClientConnector.update(testDB, &quot;Insert into Customers
                (firstName,lastName,registrationID,creditLimit,country) values ('James', 'Clerk', 200, 5000.75, 'USA')&quot;,
                               parameters);
    sql:ClientConnector.update(testDB, &quot;Insert into Customers
                (firstName,lastName,registrationID,creditLimit,country) values ('James', 'Clerk', 200, 5000.75, 'USA')&quot;,
                               parameters);
    } aborted {
        system.println(&quot;The transaction is aborted&quot;);
    }
    sql:ClientConnector.close(testDB);

</code></pre>

<p>The following is an example of the <code>abort</code> statement in a transaction.</p>
<pre><code>    map propertiesMap = {&quot;jdbcUrl&quot;:&quot;jdbc:hsqldb:file:./target/tempdb/TEST_SQL_CONNECTOR&quot;,
                         &quot;username&quot;:&quot;SA&quot;, &quot;password&quot;:&quot;&quot;, &quot;maximumPoolSize&quot;:1};
    sql:ClientConnector testDB = create sql:ClientConnector(propertiesMap);
    sql:Parameter[] parameters = [];
    transaction {
        int insertCount = sql:ClientConnector.update(testDB, &quot;Insert into Customers
                (firstName,lastName,registrationID,creditLimit,country) values ('James', 'Clerk', 220, 5000.75, 'USA')&quot;,
                                                     parameters);

        insertCount = sql:ClientConnector.update(testDB, &quot;Insert into Customers
                (firstName,lastName,registrationID,creditLimit,country) values ('James', 'Clerk', 220, 5000.75, 'USA')&quot;,
                                             parameters);
        int i = 0;
        if (i == 0) {
            abort;//transaction can be aborted based on a condition
        }
    } aborted {
        system.println(&quot;The transaction is aborted&quot;);
    }
    sql:ClientConnector.close(testDB);
</code></pre>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../lang-ref/types-variables/" class="btn btn-neutral float-right" title="Types and Variables">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../lang-ref/workers/" class="btn btn-neutral" title="Workers"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
      <p>2017 WSO2, Inc.</p>
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>
    
  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/ballerinalang/ballerina" class="icon icon-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="../../lang-ref/workers/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../lang-ref/types-variables/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script src="../../js/theme.js"></script>

</body>
</html>
